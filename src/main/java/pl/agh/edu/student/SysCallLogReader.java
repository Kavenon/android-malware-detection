package pl.agh.edu.student;

import sun.awt.AWTAccessor;

import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.HashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.util.stream.Collectors;
import java.util.stream.Stream;

public class SysCallLogReader {

    static Pattern pattern = Pattern.compile("(\\w*)\\(");

    public static LinkedList<SyscallLogRegistry> getSyscallsFromFile(Stream<String> fileStream, LogStatus fileStatus, int maxElem)
    {
        LinkedList<SyscallLogRegistry> avaiableSysCalls = new LinkedList<>();

        int counter = 0;
        fileStream.forEach(line -> {
            Matcher matcher = pattern.matcher(line);
            if(matcher.find()){
                String sysCall = matcher.group(1);
                avaiableSysCalls.add(new SyscallLogRegistry(sysCall, fileStatus));
            }
        });

        if(maxElem > 0 && maxElem < avaiableSysCalls.size())
        {
            LinkedList<SyscallLogRegistry> finalList = new LinkedList<>();
            for(int i=0; i < maxElem; i++){
                finalList.add(avaiableSysCalls.get(i));
            }
            return finalList;
        }

        return avaiableSysCalls;
    }
}
